#!/bin/bash

# ุณูุฑูุจุช ุงููุดุฑ ุงูุดุงูู: ูู ุงููุดุฑูุน ุงููุญูู ุฅูู Render.com ุนุจุฑ GitHub
# ูุฐุง ุงูุณูุฑูุจุช ูุฌูุน ูู ุฎุทูุงุช ุงููุดุฑ ูู ููุงู ูุงุญุฏ

echo "๐ ุจุฏุก ุนูููุฉ ุงููุดุฑ ุงูุดุงูู ูุชุทุจูู ButterBakery"
echo "โ๏ธ ูุฐุง ุงูุณูุฑูุจุช ุณูููู ุจุงูุฎุทูุงุช ุงูุชุงููุฉ:"
echo "  1. ุฅูุดุงุก ูุณุชูุฏุน GitHub ุฌุฏูุฏ ูุฏูุน ุงูููุฏ ุฅููู"
echo "  2. ุฅูุดุงุก ูุงุนุฏุฉ ุจูุงูุงุช PostgreSQL ูุฎุฏูุฉ ููุจ ุนูู Render.com"
echo "  3. ุฑุจุท ุฎุฏูุฉ ุงูููุจ ุจูุณุชูุฏุน GitHub ูููุดุฑ ุงูุชููุงุฆู"

# ุงูุชุญูู ูู ุชููู GitHub
if [ -z "$GITHUB_TOKEN" ]; then
    echo "โ ุฎุทุฃ: ูุชุบูุฑ ุงูุจูุฆุฉ GITHUB_TOKEN ุบูุฑ ููุฌูุฏ"
    echo "ูุฑุฌู ุชุนููู ูุชุบูุฑ ุงูุจูุฆุฉ GITHUB_TOKEN ูุจู ุชุดุบูู ูุฐุง ุงูุณูุฑูุจุช"
    exit 1
fi

# ุงูุชุญูู ูู ุชููู Render.com
if [ -z "$RENDER_API_KEY" ]; then
    echo "โ ุฎุทุฃ: ูุชุบูุฑ ุงูุจูุฆุฉ RENDER_API_KEY ุบูุฑ ููุฌูุฏ"
    echo "ูุฑุฌู ุงูุญุตูู ุนูู ููุชุงุญ API ูู Render.com ูุชุนูููู ููุชุบูุฑ ุจูุฆุฉ"
    exit 1
fi

# ุงูุชุฃูุฏ ูู ุฃู ุงูุณูุฑูุจุชุงุช ุงููุฑุนูุฉ ููุฌูุฏุฉ ููุงุจูุฉ ููุชูููุฐ
if [ ! -f "github-setup-repo.sh" ]; then
    echo "โ ุฎุทุฃ: ููู github-setup-repo.sh ุบูุฑ ููุฌูุฏ"
    exit 1
fi

if [ ! -f "render-github-connect.sh" ]; then
    echo "โ ุฎุทุฃ: ููู render-github-connect.sh ุบูุฑ ููุฌูุฏ"
    exit 1
fi

# ุฌุนู ุงูุณูุฑูุจุชุงุช ูุงุจูุฉ ููุชูููุฐ
chmod +x github-setup-repo.sh
chmod +x render-github-connect.sh

# ุชูููุฐ ุงูุฎุทูุฉ 1: ุฅูุดุงุก ูุณุชูุฏุน GitHub
echo "๐ ุฌุงุฑู ุชูููุฐ ุงูุฎุทูุฉ 1: ุฅูุดุงุก ูุณุชูุฏุน GitHub..."
./github-setup-repo.sh
if [ $? -ne 0 ]; then
    echo "โ ูุดู ุฅูุดุงุก ูุณุชูุฏุน GitHub"
    exit 1
fi

# ุชูููุฐ ุงูุฎุทูุฉ 2 ู 3: ุฅูุดุงุก ุฎุฏูุงุช Render.com ูุฑุจุทูุง ุจูุณุชูุฏุน GitHub
echo "๐ ุฌุงุฑู ุชูููุฐ ุงูุฎุทูุฉ 2 ู 3: ุฅูุดุงุก ุฎุฏูุงุช Render.com ูุฑุจุทูุง ุจูุณุชูุฏุน GitHub..."
./render-github-connect.sh
if [ $? -ne 0 ]; then
    echo "โ ูุดู ุฅูุดุงุก ุฎุฏูุงุช Render.com ุฃู ุฑุจุทูุง ุจูุณุชูุฏุน GitHub"
    exit 1
fi

# ุนุฑุถ ููุฎุต ุงููุดุฑ
if [ -f "github-repo-info.json" ] && [ -f "render-services-info.json" ]; then
    GITHUB_REPO_URL=$(cat github-repo-info.json | grep -o '"repo_url":"[^"]*' | grep -o '[^"]*$')
    RENDER_APP_URL=$(cat render-services-info.json | grep -o '"app_url":"[^"]*' | grep -o '[^"]*$')
    
    echo "๐ ุชู ุงูุชูุงู ุนูููุฉ ุงููุดุฑ ุจูุฌุงุญ!"
    echo "๐ ููุฎุต ุงููุดุฑ:"
    echo "  ๐ ูุณุชูุฏุน GitHub: $GITHUB_REPO_URL"
    echo "  ๐ ุชุทุจูู Render.com: $RENDER_APP_URL"
    echo ""
    echo "โฑ๏ธ ูุฏ ุชุณุชุบุฑู ุนูููุฉ ุงูุจูุงุก ูุงููุดุฑ ุงูุฃูููุฉ ุจุถุน ุฏูุงุฆู"
    echo "๐ ููููู ูุชุงุจุนุฉ ุนูููุฉ ุงูุจูุงุก ูู ููุญุฉ ุชุญูู Render.com"
    echo "๐ ูุนูููุงุช ุชุณุฌูู ุงูุฏุฎูู ุงูุงูุชุฑุงุถูุฉ:"
    echo "  ๐ค ุงุณู ุงููุณุชุฎุฏู: admin"
    echo "  ๐ ูููุฉ ุงููุฑูุฑ: admin"
    echo "  โ๏ธ ููุฑุฌู ุชุบููุฑ ูููุฉ ุงููุฑูุฑ ุงูุงูุชุฑุงุถูุฉ ููุฑ ุชุณุฌูู ุงูุฏุฎูู ูุฃูู ูุฑุฉ"
else
    echo "โ๏ธ ุชู ุชูููุฐ ุงูุณูุฑูุจุชุ ูููู ูู ูุชู ุงูุนุซูุฑ ุนูู ูููุงุช ุงููุนูููุงุช ุงููุงููุฉ"
fi

echo "๐ ุงูุชูู ุชูููุฐ ุณูุฑูุจุช ุงููุดุฑ ุงูุดุงูู"