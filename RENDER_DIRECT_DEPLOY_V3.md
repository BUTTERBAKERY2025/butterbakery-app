# دليل النشر المباشر على Render.com - الإصدار الثالث (محدث)

## محتويات الملف المضغوط

تم تحديث حزمة النشر `butterbakery-render-deployment-v3.zip` وإعادة تنظيم هيكل الملفات بشكل صحيح للنشر على Render.com. يحتوي الملف المضغوط على:

- جميع ملفات المشروع الأساسية في المستوى الرئيسي (`package.json`, `start.js`, `render.yaml`)
- جميع الدلائل والملفات اللازمة للتطبيق (`client`, `server`, `shared`, `public`)
- ملفات تكوين إضافية لضمان استقرار التطبيق (`.npmrc`, `tsconfig.json`)
- المكونات اللازمة للتواصل مع قاعدة البيانات

## طرق النشر على Render.com

### الطريقة 1: النشر المباشر بواسطة ملف render.yaml (موصى بها)

1. **إنشاء مشروع جديد**:
   - قم بتسجيل الدخول إلى حسابك على Render.com
   - انقر على "New +" ثم اختر "Blueprint"

2. **تهيئة المشروع**:
   - اختر "Upload YAML file"
   - قم بتحميل ملف `render.yaml` المضمن في حزمة النشر
   - انقر على "Apply"

3. **انتظر تهيئة الموارد**:
   - سيقوم Render.com تلقائياً بإنشاء قاعدة بيانات وخدمة ويب
   - انتظر حتى اكتمال الإعداد (قد يستغرق 5-10 دقائق)

4. **رفع ملفات التطبيق**:
   - بعد اكتمال إنشاء الموارد، انتقل إلى خدمة الويب التي تم إنشاؤها
   - انقر على "Manual Deploy" ثم "Upload Files"
   - قم بتحميل ملفات المشروع (يمكنك فك ضغط الملف المضغوط ورفع الملفات مباشرةً)

### الطريقة 2: النشر اليدوي التقليدي

1. **إنشاء قاعدة بيانات**:
   - انقر على "New +" ثم اختر "PostgreSQL"
   - أكمل إعداد قاعدة البيانات واحفظ معلومات الاتصال

2. **إنشاء خدمة جديدة**:
   - انقر على "New +" ثم اختر "Web Service"
   - في صفحة تهيئة الخدمة، اختر "Upload Files"
   - قم بتحميل ملف `butterbakery-render-deployment-v3.zip`

3. **تكوين إعدادات النشر**:
   - **Name**: اختر اسم خدمتك (مثال: `butterbakery-op`)
   - **Region**: اختر المنطقة الأقرب لمستخدميك (نفس منطقة قاعدة البيانات)
   - **Runtime**: اختر `Node`
   - **Node Version**: `20.x`
   - **Build Command**: `npm install`
   - **Start Command**: `node start.js`

4. **إعداد المتغيرات البيئية**:
   - تحت قسم "Environment Variables"، أضف المتغيرات التالية:
     - `NODE_ENV`: `production`
     - `PORT`: `10000`
     - `DATABASE_URL`: رابط اتصال قاعدة البيانات PostgreSQL
     - `SESSION_SECRET`: قيمة عشوائية طويلة (مثال: `butterbakery-session-secret-key-123`)
     - `TZ`: `Asia/Riyadh` (منطقة زمنية مناسبة للمملكة العربية السعودية)
     - `NODE_OPTIONS`: `--max-old-space-size=512`

5. **خيارات متقدمة**:
   - قم بتمكين "Health Check Path" واضبطه على `/health`
   - ضبط "Auto-Deploy" على "No" للتحكم في عمليات النشر

## النشر المباشر بواسطة سكريبت (للمطورين)

إذا كنت تريد النشر بشكل مباشر باستخدام واجهة برمجة التطبيقات API، يمكنك استخدام السكريبت المرفق:

1. قم بتنزيل `render-direct-deploy.sh` من حزمة النشر
2. قم بتوفير Render API Key في متغير بيئي:
   ```
   export RENDER_API_KEY=your_api_key_here
   ```
3. قم بتنفيذ السكريبت:
   ```
   bash render-direct-deploy.sh
   ```

سيقوم السكريبت تلقائياً بإنشاء قاعدة بيانات وخدمة ويب ونشر التطبيق.

## تأكيد نجاح النشر

بعد اكتمال عملية النشر، ستتمكن من الوصول إلى تطبيقك عبر الرابط الذي يوفره Render.com. يمكنك تسجيل الدخول باستخدام:

- اسم المستخدم: `admin`
- كلمة المرور: `admin`

**تنبيه أمني**: قم بتغيير كلمة المرور الافتراضية بعد تسجيل الدخول لأول مرة.

## استكشاف الأخطاء وإصلاحها

إذا واجهت أي مشاكل أثناء النشر، جرب الخطوات التالية:

1. **تحقق من سجلات التطبيق**:
   - انتقل إلى صفحة الخدمة الخاصة بك
   - انقر على تبويب "Logs"
   - ابحث عن أي رسائل خطأ واضحة

2. **مشاكل شائعة وحلولها**:
   - **خطأ MODULE_NOT_FOUND**: تأكد من اكتمال عملية `npm install`
   - **خطأ في الاتصال بقاعدة البيانات**: تأكد من صحة متغير `DATABASE_URL`
   - **مشكلة في نهاية الخدمة (timeout)**: زد قيمة الـ `NODE_OPTIONS` لزيادة مساحة الذاكرة
   - **مشاكل في الرسوم العربية**: تأكد من ضبط `TZ` بشكل صحيح

3. **إعادة النشر**:
   - جرب النقر على "Manual Deploy" ثم "Clear Build Cache & Deploy"
   - هذا سيؤدي إلى إعادة تحميل جميع التبعيات من الصفر

## التواصل مع الدعم

إذا كنت بحاجة إلى مساعدة إضافية، يمكنك التواصل مع فريق الدعم الفني عبر:

- البريد الإلكتروني: support@company.com
- رقم الهاتف: +123456789